// Prisma Schema for Marketplace App
// Docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================
// LISTING PREVIEW - Initial scraped data from marketplace
// ============================================
model ListingPreview {
  id String @id @default(uuid())

  // Preview data (from marketplace_listings.json)
  link     String  @unique // Facebook listing URL
  title    String
  price    String  // "$150"
  location String? // "Auburn, AL"
  imageUrl String? // Preview thumbnail

  // Lifecycle tracking
  firstSeenAt      DateTime  @default(now()) // When we first discovered this listing
  lastSeenAt       DateTime  @updatedAt      // Last time we saw it in a scrape
  detailsScrapedAt DateTime?                 // NULL = not scraped yet, set = scraped (with timestamp)

  // Relation to full listing details
  listing Listing? // Optional - only exists after detail scrape
}

// ============================================
// LISTING - A Facebook Marketplace listing (full details)
// ============================================
model Listing {
  id String @id @default(uuid())

  // Basic info
  title       String
  price       String // "$150" - keeping as string for flexibility
  description String? // Optional - some listings have none
  condition   String? // "Used - Good", "New", etc.
  location    String? // "Auburn, AL"

  // Images
  imageUrls String[] // Array of image URLs

  // Source info
  sourceUrl String @unique // Facebook listing URL (unique to avoid duplicates)

  // Dates
  listedAt  DateTime? // When seller listed it (calculated)
  scrapedAt DateTime  @default(now()) // When we scraped it

  // Link to preview (optional - for tracking)
  previewId String?         @unique
  preview   ListingPreview? @relation(fields: [previewId], references: [id])

  // Relation to price estimate
  priceEstimate PriceEstimate? // One listing has one (optional) price estimate
}

// ============================================
// PRICE ESTIMATE - AI-generated fair market value
// ============================================
model PriceEstimate {
  id String @id @default(uuid())

  // The estimate
  estimatedPrice String? // "$40 - $80"
  aiResponse     String? // Full AI response text

  // Timestamps
  createdAt DateTime @default(now())

  // Relation to listing
  listingId String  @unique // Foreign key
  listing   Listing @relation(fields: [listingId], references: [id])
}
